# The Indie Quill Collective

## Overview
The Indie Quill Collective is a 501(c)(3) non-profit platform designed to support emerging authors from application through publishing. It integrates author management, contract handling (including provisions for minor authors), and professional publishing services with The Indie Quill LLC. The platform ensures legal compliance (COPPA, GDPR) and includes modules for grant and donor logistics, board management, and a virtual classroom for literacy education, aiming to nurture new literary talent comprehensively.

## User Preferences
I prefer clear, concise explanations and a direct communication style. For coding tasks, I value modularity and well-structured code. When making changes, please prioritize security, compliance, and maintainability. Always ask for confirmation before implementing major architectural changes or significant code refactoring. I prefer an iterative development approach, with regular updates and opportunities for feedback.

## System Architecture
The project utilizes a client-server architecture. The frontend is built with React 19, Vite, and TailwindCSS 3, while the backend uses Express.js with TypeScript. Data is managed in a PostgreSQL database provided by Supabase, accessed via Drizzle ORM. Client-side routing is handled by Wouter.

**UI/UX Decisions:**
- **Typography:** Playfair Display for headings and Inter for body text.
- **Color Scheme:** Teal and blue.
- **Styling:** Standard Tailwind CSS classes.

**Security Features:**
- **HTTP Security:** Helmet.js for HTTP header protection.
- **Rate Limiting:** `express-rate-limit` on critical endpoints.
- **Secure Sessions:** `httpOnly` and `sameSite="strict"` session cookies.
- **Password Security:** `crypto.scrypt` with random salt for hashing.
- **Database Security:** Drizzle ORM for SQL injection protection.
- **Compliance:** COPPA audit logging for minor data, PII firewall for external syncs.
- **Access Control:** Role-based guards for protected pages, supporting dual roles.
- **Signature Gate:** Enterprise sync requires all necessary contract signatures.

**Technical Implementations:**
- **Author Application & Contracts:** Multi-step application, contract generation on acceptance, forensic metadata for e-signatures, PDF download.
- **Compliance:** COPPA guardian consent tracking, GDPR data export and cascading account deletion.
- **Integrations:** Automatic syncing with The Indie Quill LLC (HMAC-SHA256 signed), Google Calendar two-way sync, Stripe for donations.
- **Admin Features:** Comprehensive dashboard for user, application, cohort, board, grant, and ledger management.
- **VibeScribe Mobile App:** Native iOS/Android app built with Expo/React Native in `apps/mobile/`. Monorepo structure. Features: 6-digit Scribe ID keypad login, giant record button with audio capture (expo-av), OpenAI Whisper transcription via `/api/vibe/transcribe`, text-to-speech playback (expo-speech), "Send to Workspace" saves drafts via `/api/vibe/save-draft`, transcript history via `/api/vibe/history`. Dark theme (navy/teal). No embedded API keys - uses Scribe ID-based auth. Expo Go QR code on port 8080.
- **Curriculum System (rebranded):** 4-tier hierarchy: Curriculum > Catalog > Lesson > Task. UI labels use Catalog/Lesson/Task; database tables retain original names (`vibe_decks`, `tomes`, `vibe_cards`). `curriculums` table (role-based paths: Published Writer, Adult Student, Family of Students), `vibe_decks` table (catalogs within a curriculum), `tomes` table (lessons within a catalog - id, deck_id, title, content, order_index), `vibe_cards` table (individual tasks within a lesson - references tome_id, not deck_id; includes `task_type` column: 'writing'|'speaking'|'comprehension', default 'writing'). Admin Curriculum Builder with full CRUD at all 4 levels, inline editing, and nested accordion UI. Student view shows published curricula with expandable catalogs > lessons > tasks.
- **Lessons (formerly Tomes of Wisdom):** Lesson-level educational content that gates task access. Each lesson is a separate entity under a catalog with its own title and content. Students must complete each lesson individually to unlock its tasks. "Folio Reveal" transition: fade-in backdrop, slide-up paper card with paper-grain texture (#FDFBF7 + SVG noise), expanding rule line, staggered ink-in content reveal. Playfair Display headings, EB Garamond body text, charcoal drop cap. Tables: `tomes` (deck_id, title, content, order_index), `tome_absorptions` (user_id VARCHAR, tome_id, absorbed_at).
- **Scribe's Sanctum (Workspace):** Full-page writer's workspace at `/student/workspace`. Three-pane layout: left sidebar (Task List + VibeScribe Inspiration Feed), center (TipTap rich text editor), bottom (word count + reading time). Two modes: "Project View" (Master Manuscript - the book) and "Task View" (individual Vibe Card writing). Full Word-style toolbar: Bold, Italic, Underline, Strikethrough, H1/H2/H3, Bullet/Ordered Lists, Blockquote, Text Alignment (left/center/right), Undo/Redo. Master Manuscript stored as TipTap JSON in JSONB column. "Move to Master Manuscript" button appends task content to master. Voice snippet injection at cursor position. Reference modal for viewing card instructions while writing. Auto-save every 2 seconds. Transcript polling every 10 seconds. Tables: `master_manuscripts` (user_id UNIQUE, title, content JSONB, word_count), `vibescribe_transcripts` (user_id, vibescribe_id, content, source_type, is_used). API: `POST /api/integration/vibescribe` (API key auth for VibeScribe voice app), `GET /api/student/vibescribe-transcripts`, `GET/PUT /api/student/master-manuscript`, `GET /api/student/workspace-cards`.
- **Manuscript Editor (Legacy):** TipTap-based rich text editor modal opens from "Start Writing" button on Vibe Card back. Auto-saves drafts every 2 seconds. Tables: `manuscripts` (user_id VARCHAR, card_id, content, word_count).
- **Card Submission Flow:** Self-report submission with brief reflection. Student writes manuscript, clicks "Submit for Review," provides reflection text. Card visually changes to completed state (green). Tables: `card_submissions` (user_id VARCHAR, card_id, manuscript_id, reflection, xp_earned, status, paste_count INTEGER, is_flagged_for_review BOOLEAN).
- **Soft Integrity Layer:** Tracks copy-paste behavior during manuscript writing sessions. TipTap's handlePaste captures pasted character count. On submission, if pasted characters exceed 50% of total manuscript content, `is_flagged_for_review` is auto-set to true. Admin Submissions tab shows all submissions with integrity badges (flagged/clear). AI review utility in `server/services/integrity-context.ts` provides prompt context for flagged submissions.
- **Author Metrics System (replaced XP):** Word-count-based progression replaces the old RPG/XP system. `AuthorScorecard` component in right sidebar shows Words Spoken (VibeScribe transcripts), Words Written (manuscripts + master manuscripts), and Total Output. 3x3 "Legacy Seals" badge grid with curriculum-milestone and word-count badges. Final 9 badges: `entry_of_record` ("The Entry of Record" — L01 complete), `structural_integrity` ("Structural Integrity" — L03 complete), `readers_mark` ("The Reader's Mark" — L05 complete), `foundations_mastery` ("Foundations Mastery" — all Catalog 01 complete), `voice_seal` ("Voice" — 1K spoken), `ink_seal` ("Ink" — 1K written), `specialist_seal` ("Specialist" — path chosen), `5k_club` ("5K Club" — 5K total), `10k_club` ("10K Club" — 10K total). Badges auto-evaluate on each `/api/student/author-metrics` fetch. Badge query uses curriculum title `'Published Writer'` and `vd.order_index = 1` to find Catalog 01 tomes. `game_characters` table extended with `author_path` (VARCHAR) and `badges` (JSONB). Old game-engine.ts file retained but awardXP() no longer called from submission/absorption flows. XP removed from all student-facing UI.
- **Catalog 01 Seeded:** "The Universal Core" contains 5 lessons with 3 tasks each (15 total). Each lesson has one speaking, one comprehension, and one writing task. Lessons: The Author's Mindset, The Big Idea Validation, The Narrative Blueprint, Mastering the VibeScribe Flow, The Reader's Promise. Seed script at `scripts/seed-catalog-01.ts` runs against both DEV and PROD databases.
- **Author Path Selection ("The Induction"):** After completing all 5 lessons of Catalog 01 (foundations_mastery badge earned), the PathSelectionModal appears automatically. Full-screen Folio overlay with paper grain, rule line, and four elegant vertical cards with custom SVG press marks. Paths: Novelist (fountain pen nib), Authority (magnifying glass over text), Poet (organic feather), Storyteller (pocket watch). Modal cannot be dismissed without choosing a path. On selection, calls `POST /api/student/author-path`, unlocks specialist_seal badge, and filters curriculum to show only Universal Core + chosen path's catalog. `vibe_decks` table has `specialization` column (VARCHAR 50) — null for Universal Core, 'novelist'/'authority'/'poet'/'storyteller' for specialized catalogs. Four placeholder catalogs seeded: "The Novelist's Craft" (id 102), "The Authority's Framework" (id 103), "The Poet's Voice" (id 104), "The Storyteller's Art" (id 105). Component: `client/src/components/PathSelectionModal.tsx`.
- **Email Notifications:** Automated via Resend for key events. Admin email is dynamically configurable via `system_settings` table (key: `admin_email`), cached 60s with fallback to `jon@theindiequill.com`. Admin can update via Operations > Email Settings in dashboard. All emails (CC, failure alerts, mentor contacts) use dynamic lookup. "Contact your mentor" button on Student Dashboard sends messages to admin email via `/api/contact-mentor`.
- **Catalog 02 Seeded ("The Novelist's Craft"):** Specialization catalog for `author_path = 'novelist'`. Contains 5 lessons with 3 tasks each (15 total, typed speaking/comprehension/writing). Lessons: Your Hero's Big Wish, A World That Feels Real, The Big Change, People Talking, The Big Finish. Written in "Michener-simple" 5th-grade style. Seed script at `scripts/seed-catalog-02.ts`. `specialization` column added to `vibe_decks` table on both DEV and PROD Supabase databases.
- **Catalog 03 Seeded ("The Authority's Framework"):** Specialization catalog for `author_path = 'authority'`. Contains 5 lessons with 3 tasks each (15 total, typed speaking/comprehension/writing). Lessons: The Big Problem, The Pillar Method, The Power of Proof, The Teacher's Voice, The Call to Action. Written in "Michener-simple" 5th-grade style. Seed script at `scripts/seed-catalog-03.ts`.
- **Catalog 04 Seeded ("The Storyteller's Art"):** Specialization catalog for `author_path = 'storyteller'`. Contains 5 lessons with 3 tasks each (15 total, typed speaking/comprehension/writing). Lessons: The Single Spark, Starting in the Middle, The Power of One, The Sharp Twist, The Echo. Written in "Michener-simple" 5th-grade style. Seed script at `scripts/seed-catalog-04.ts`.
- **Catalog 05 Seeded ("The Poet's Voice"):** Specialization catalog for `author_path = 'poet'`. Contains 5 lessons with 3 tasks each (15 total, typed speaking/comprehension/writing). Lessons: The Image as an Anchor, The Music of Words, The Power of White Space, The Unexpected Turn, The Soul's Signature. Seed script at `scripts/seed-catalog-05.ts`.
- **Community Page ("The Quill Collective"):** Renamed from "Fellowship of the Quill." Three-column participatory hub at `/student/community`. Column 1: "The Lineage" (Campbell, Jenkins, Michener, Rainey, The Novelry). Column 2: "Our Partners" (Founding Visionary, Founding 25, Open Ledger) with "Become a Patron" button. Column 3: "The Writer's Council" (Fiction Lead, Non-Fiction Lead, Poetry Consultant — all vacant/recruiting) with "Apply for the Council" mailto button in Academy Blue. Paper grain (#FDFBF7 + SVG noise) background on all cards.

## Important Accounts
- **Apple Review Demo Account:** Scribe ID `123-456` (Buildathon Tester, buildathon.tester@theindiequill.org, role: student). This is the permanent demo account for Apple's App Store review team. Do not delete or modify this user.

## App Store Compliance Notes
- **Issue 90725 (SDK Version):** Starting April 28, 2026, all iOS and iPadOS apps must be built with the iOS 26 SDK or later (included in Xcode 26 or later) to be uploaded to App Store Connect or submitted for distribution. Current builds use iOS 18.2 SDK — must upgrade before that deadline.

## External Dependencies
- **Supabase:** PostgreSQL database services.
- **Google Calendar API:** For two-way event synchronization.
- **The Indie Quill LLC API:** For secure author data synchronization.
- **Stripe:** For payment processing (donations).
- **Resend:** For transactional email delivery.
- **OpenAI:** For VibeScribe audio transcription.
- **GitHub:** For source code version control.
- **Render:** Cloud platform for hosting production services.